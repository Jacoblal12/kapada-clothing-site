<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Kapada - Place Order</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      background: #f9f9f9;
    }

    form {
      max-width: 500px;
      margin: auto;
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    h2 {
      text-align: center;
      margin-bottom: 1rem;
    }

    input,
    textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    button {
      padding: 10px 20px;
      background: #e91e63;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background: #d81b60;
    }
  </style>
</head>

<body>
  <form id="orderForm">
    <h2>Place Your Order</h2>
    <input type="text" name="name" placeholder="Your Name" required>
    <input type="text" name="product" id="product" placeholder="Product Name" required>
    <input type="number" name="quantity" id="quantity" placeholder="Quantity" required>
    <input type="text" name="address" placeholder="Delivery Address" required>
    <input type="tel" name="phone" placeholder="Phone Number" required>
    <button type="submit">Place Order</button>
  </form>

  <script>
    // Load product and quantity from localStorage
    const cart = JSON.parse(localStorage.getItem('kapada-cart')) || [];
    if (cart.length > 0) {
      const counts = {};
      cart.forEach(item => { counts[item] = (counts[item] || 0) + 1; });
      const firstItem = Object.keys(counts)[0];
      document.getElementById('product').value = firstItem;
      document.getElementById('quantity').value = counts[firstItem];
    }

    // --- send order via Google Apps Script relay ---
    const scriptURL = "https://script.google.com/macros/library/d/1qravVbnnzqOEo1OuBFT8F-p6BTYnY1CrIqj67R6kd0UVfwaNg7CnTp6Y/1"; // paste your deployed script URL here
    const SECRET_KEY = "Kapada123!OrderKey"; // same as in GAS script
    const form = document.getElementById("orderForm");

    form.addEventListener("submit", e => {
      e.preventDefault();
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      // include secret key
      data.secret = SECRET_KEY;

      fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify(data)
      })
        .then(response => response.text())
        .then(res => {
          if (res.includes("SUCCESS")) {
            alert("✅ Order placed successfully!");
            form.reset();
            localStorage.removeItem('kapada-cart');
          } else {
            alert("❌ Failed to place order. Server said: " + res);
          }
        })
        .catch(error => {
          alert("❌ Failed to place order. Please try again.");
          console.error(error);
        });
    });

  </script>
</body>

</html>